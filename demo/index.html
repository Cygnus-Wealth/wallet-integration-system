<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wallet Integration Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .card h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.5em;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #333;
    }

    select, input {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 1em;
      transition: border-color 0.3s;
    }

    select:focus, input:focus {
      outline: none;
      border-color: #667eea;
    }

    .button-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 20px;
    }

    button {
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    button.primary {
      background: #667eea;
      color: white;
    }

    button.primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    button.secondary {
      background: #f5f5f5;
      color: #333;
    }

    button.secondary:hover {
      background: #e0e0e0;
    }

    button.danger {
      background: #ef4444;
      color: white;
    }

    button.danger:hover {
      background: #dc2626;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .status {
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-weight: 500;
    }

    .status.connected {
      background: #d1fae5;
      color: #065f46;
      border: 2px solid #10b981;
    }

    .status.disconnected {
      background: #fee2e2;
      color: #991b1b;
      border: 2px solid #ef4444;
    }

    .status.info {
      background: #dbeafe;
      color: #1e40af;
      border: 2px solid #3b82f6;
    }

    .output {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .output .success {
      color: #4ade80;
    }

    .output .error {
      color: #f87171;
    }

    .output .info {
      color: #60a5fa;
    }

    .account-list {
      list-style: none;
      margin-top: 10px;
    }

    .account-item {
      padding: 10px;
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .account-item.active {
      background: #dbeafe;
      border-color: #3b82f6;
    }

    .account-item button {
      padding: 6px 12px;
      font-size: 0.9em;
    }

    .warning {
      background: #fef3c7;
      color: #92400e;
      padding: 15px;
      border-radius: 6px;
      border: 2px solid #f59e0b;
      margin-bottom: 20px;
    }

    .warning strong {
      display: block;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üîê Wallet Integration Demo</h1>
      <p>Test multi-chain wallet connections</p>
    </div>

    <div class="warning">
      <strong>‚ö†Ô∏è Demo Mode</strong>
      This demo simulates wallet interactions without requiring actual wallet extensions.
      For real wallet testing, you'll need MetaMask, Phantom, or Suiet installed.
    </div>

    <div class="card">
      <h2>Connection Setup</h2>

      <div class="form-group">
        <label for="chain-select">Select Blockchain</label>
        <select id="chain-select">
          <option value="ETHEREUM">Ethereum (EVM)</option>
          <option value="POLYGON">Polygon (EVM)</option>
          <option value="ARBITRUM">Arbitrum (EVM)</option>
          <option value="OPTIMISM">Optimism (EVM)</option>
          <option value="BSC">Binance Smart Chain (EVM)</option>
          <option value="AVALANCHE">Avalanche (EVM)</option>
          <option value="BASE">Base (EVM)</option>
          <option value="SOLANA">Solana</option>
          <option value="SUI">SUI</option>
        </select>
      </div>

      <div class="form-group">
        <label for="source-select">Wallet Source</label>
        <select id="source-select">
          <option value="METAMASK">MetaMask</option>
          <option value="PHANTOM">Phantom</option>
          <option value="SUIET">Suiet</option>
        </select>
      </div>

      <div id="status-display" class="status disconnected">
        Status: Disconnected
      </div>

      <div class="button-group">
        <button class="primary" id="connect-btn">Connect Wallet</button>
        <button class="danger" id="disconnect-btn" disabled>Disconnect</button>
        <button class="secondary" id="refresh-accounts-btn" disabled>Refresh Accounts</button>
        <button class="secondary" id="test-factory-btn">Test Factory</button>
      </div>
    </div>

    <div class="card" id="accounts-card" style="display: none;">
      <h2>Accounts</h2>
      <ul id="account-list" class="account-list"></ul>
    </div>

    <div class="card">
      <h2>Console Output</h2>
      <div id="output" class="output">
Ready. Select a chain and click "Connect Wallet" to begin.

Available test features:
- Connect to simulated wallets
- View and switch between accounts
- Test WalletIntegrationFactory
- View detailed logs of operations
      </div>
    </div>
  </div>

  <script type="module">
    // Simulated wallet integrations for demo purposes
    class DemoWalletIntegration {
      constructor(chain, source) {
        this.chain = chain;
        this.source = source;
        this.connected = false;
        this.accounts = [];
        this.activeAccountIndex = 0;
      }

      async connect() {
        log('info', `Connecting to ${this.chain} via ${this.source}...`);

        // Simulate connection delay
        await sleep(500);

        // Generate mock accounts based on chain type
        this.accounts = this.generateMockAccounts();
        this.connected = true;
        this.activeAccountIndex = 0;

        log('success', `‚úì Connected successfully!`);
        log('info', `Found ${this.accounts.length} accounts`);

        return {
          address: this.accounts[0].address,
          chain: this.chain,
          source: this.source,
          connected: true,
          connectedAt: new Date(),
          accounts: [...this.accounts],
          activeAccount: this.accounts[0]
        };
      }

      async disconnect() {
        log('info', `Disconnecting from ${this.chain}...`);
        await sleep(300);
        this.connected = false;
        this.accounts = [];
        this.activeAccountIndex = 0;
        log('success', '‚úì Disconnected successfully');
      }

      async getAllAccounts() {
        if (!this.connected) {
          throw new Error('Wallet not connected');
        }
        return [...this.accounts];
      }

      async switchAccount(address) {
        const index = this.accounts.findIndex(
          acc => acc.address.toLowerCase() === address.toLowerCase()
        );
        if (index === -1) {
          throw new Error(`Account ${address} not found`);
        }
        this.activeAccountIndex = index;
        log('success', `‚úì Switched to account: ${address}`);
      }

      async getActiveAccount() {
        if (!this.connected || this.accounts.length === 0) {
          return null;
        }
        return this.accounts[this.activeAccountIndex];
      }

      isConnected() {
        return this.connected;
      }

      generateMockAccounts() {
        const isEVM = ['ETHEREUM', 'POLYGON', 'ARBITRUM', 'OPTIMISM', 'BSC', 'AVALANCHE', 'BASE'].includes(this.chain);
        const isSolana = this.chain === 'SOLANA';
        const isSUI = this.chain === 'SUI';

        if (isEVM) {
          return [
            { address: '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEbC', index: 0, label: 'Account 1' },
            { address: '0x1234567890123456789012345678901234567890', index: 1, label: 'Account 2' },
            { address: '0xABCDEF1234567890ABCDEF1234567890ABCDEF12', index: 2, label: 'Account 3' }
          ];
        } else if (isSolana) {
          return [
            { address: 'DYw8jCTfwHNRJhhmFcbXvVDTqWMEVFBX6ZKUmG5CNSKK', index: 0, label: 'Account 1' },
            { address: '7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU', index: 1, label: 'Account 2' }
          ];
        } else if (isSUI) {
          return [
            { address: '0x' + 'a'.repeat(64), index: 0, label: 'Account 1' },
            { address: '0x' + 'b'.repeat(64), index: 1, label: 'Account 2' }
          ];
        }

        return [];
      }
    }

    class DemoWalletFactory {
      create(chain, source) {
        log('info', `Factory: Creating integration for ${chain} (${source})`);
        const supportedChains = [
          'ETHEREUM', 'POLYGON', 'ARBITRUM', 'OPTIMISM', 'BSC', 'AVALANCHE', 'BASE',
          'SOLANA', 'SUI'
        ];

        if (!supportedChains.includes(chain)) {
          throw new Error(`Chain ${chain} not supported. Supported: ${supportedChains.join(', ')}`);
        }

        return new DemoWalletIntegration(chain, source);
      }

      isChainSupported(chain) {
        const supportedChains = [
          'ETHEREUM', 'POLYGON', 'ARBITRUM', 'OPTIMISM', 'BSC', 'AVALANCHE', 'BASE',
          'SOLANA', 'SUI'
        ];
        return supportedChains.includes(chain);
      }

      getSupportedChains() {
        return [
          'ETHEREUM', 'POLYGON', 'ARBITRUM', 'OPTIMISM', 'BSC', 'AVALANCHE', 'BASE',
          'SOLANA', 'SUI'
        ];
      }
    }

    // Global state
    let currentIntegration = null;
    const factory = new DemoWalletFactory();

    // UI Elements
    const chainSelect = document.getElementById('chain-select');
    const sourceSelect = document.getElementById('source-select');
    const statusDisplay = document.getElementById('status-display');
    const connectBtn = document.getElementById('connect-btn');
    const disconnectBtn = document.getElementById('disconnect-btn');
    const refreshAccountsBtn = document.getElementById('refresh-accounts-btn');
    const testFactoryBtn = document.getElementById('test-factory-btn');
    const output = document.getElementById('output');
    const accountsCard = document.getElementById('accounts-card');
    const accountList = document.getElementById('account-list');

    // Helper functions
    function log(type, message) {
      const timestamp = new Date().toLocaleTimeString();
      const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
      const prefix = type === 'error' ? '‚úó' : type === 'success' ? '‚úì' : '‚Ñπ';
      output.innerHTML += `<span class="${className}">[${timestamp}] ${prefix} ${message}</span>\n`;
      output.scrollTop = output.scrollHeight;
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function updateStatus(connected) {
      if (connected) {
        statusDisplay.className = 'status connected';
        statusDisplay.textContent = `Status: Connected to ${chainSelect.value}`;
        connectBtn.disabled = true;
        disconnectBtn.disabled = false;
        refreshAccountsBtn.disabled = false;
      } else {
        statusDisplay.className = 'status disconnected';
        statusDisplay.textContent = 'Status: Disconnected';
        connectBtn.disabled = false;
        disconnectBtn.disabled = true;
        refreshAccountsBtn.disabled = true;
        accountsCard.style.display = 'none';
      }
    }

    async function displayAccounts() {
      if (!currentIntegration || !currentIntegration.isConnected()) {
        accountsCard.style.display = 'none';
        return;
      }

      const accounts = await currentIntegration.getAllAccounts();
      const activeAccount = await currentIntegration.getActiveAccount();

      accountList.innerHTML = '';
      accounts.forEach((account, index) => {
        const li = document.createElement('li');
        li.className = 'account-item';
        if (activeAccount && account.address === activeAccount.address) {
          li.className += ' active';
        }

        const addressSpan = document.createElement('span');
        addressSpan.textContent = `${account.label}: ${account.address.substring(0, 10)}...${account.address.substring(account.address.length - 8)}`;

        const switchBtn = document.createElement('button');
        switchBtn.className = 'secondary';
        switchBtn.textContent = account.address === activeAccount?.address ? 'Active' : 'Switch';
        switchBtn.disabled = account.address === activeAccount?.address;
        switchBtn.onclick = () => handleSwitchAccount(account.address);

        li.appendChild(addressSpan);
        li.appendChild(switchBtn);
        accountList.appendChild(li);
      });

      accountsCard.style.display = 'block';
    }

    // Event handlers
    async function handleConnect() {
      try {
        const chain = chainSelect.value;
        const source = sourceSelect.value;

        log('info', `Creating wallet integration...`);
        currentIntegration = factory.create(chain, source);

        const connection = await currentIntegration.connect();

        log('success', `Connection details:`);
        log('info', `  Chain: ${connection.chain}`);
        log('info', `  Source: ${connection.source}`);
        log('info', `  Active Address: ${connection.address}`);
        log('info', `  Total Accounts: ${connection.accounts.length}`);

        updateStatus(true);
        await displayAccounts();
      } catch (error) {
        log('error', `Connection failed: ${error.message}`);
      }
    }

    async function handleDisconnect() {
      try {
        if (currentIntegration) {
          await currentIntegration.disconnect();
          currentIntegration = null;
        }
        updateStatus(false);
      } catch (error) {
        log('error', `Disconnect failed: ${error.message}`);
      }
    }

    async function handleRefreshAccounts() {
      try {
        log('info', 'Refreshing accounts...');
        await displayAccounts();
        log('success', '‚úì Accounts refreshed');
      } catch (error) {
        log('error', `Refresh failed: ${error.message}`);
      }
    }

    async function handleSwitchAccount(address) {
      try {
        await currentIntegration.switchAccount(address);
        await displayAccounts();
      } catch (error) {
        log('error', `Switch account failed: ${error.message}`);
      }
    }

    function handleTestFactory() {
      log('info', '=== Testing WalletIntegrationFactory ===');

      const chains = factory.getSupportedChains();
      log('success', `Supported chains (${chains.length}): ${chains.join(', ')}`);

      // Test isChainSupported
      log('info', '\nTesting isChainSupported():');
      log('success', `  ETHEREUM: ${factory.isChainSupported('ETHEREUM')}`);
      log('success', `  SOLANA: ${factory.isChainSupported('SOLANA')}`);
      log('error', `  UNKNOWN: ${factory.isChainSupported('UNKNOWN')}`);

      // Test creating integrations
      log('info', '\nTesting integration creation:');
      try {
        const ethIntegration = factory.create('ETHEREUM', 'METAMASK');
        log('success', `  ‚úì Created EVM integration: ${ethIntegration.chain}`);
      } catch (error) {
        log('error', `  ‚úó Failed: ${error.message}`);
      }

      try {
        const solIntegration = factory.create('SOLANA', 'PHANTOM');
        log('success', `  ‚úì Created Solana integration: ${solIntegration.chain}`);
      } catch (error) {
        log('error', `  ‚úó Failed: ${error.message}`);
      }

      try {
        const suiIntegration = factory.create('SUI', 'SUIET');
        log('success', `  ‚úì Created SUI integration: ${suiIntegration.chain}`);
      } catch (error) {
        log('error', `  ‚úó Failed: ${error.message}`);
      }

      log('info', '\n=== Factory test complete ===\n');
    }

    // Event listeners
    connectBtn.addEventListener('click', handleConnect);
    disconnectBtn.addEventListener('click', handleDisconnect);
    refreshAccountsBtn.addEventListener('click', handleRefreshAccounts);
    testFactoryBtn.addEventListener('click', handleTestFactory);

    // Update source selector based on chain
    chainSelect.addEventListener('change', () => {
      const chain = chainSelect.value;
      const isEVM = ['ETHEREUM', 'POLYGON', 'ARBITRUM', 'OPTIMISM', 'BSC', 'AVALANCHE', 'BASE'].includes(chain);
      const isSolana = chain === 'SOLANA';
      const isSUI = chain === 'SUI';

      if (isEVM) {
        sourceSelect.value = 'METAMASK';
      } else if (isSolana) {
        sourceSelect.value = 'PHANTOM';
      } else if (isSUI) {
        sourceSelect.value = 'SUIET';
      }
    });

    log('success', 'Demo app initialized successfully!');
    log('info', 'This is a simulated environment for testing the wallet integration architecture.');
  </script>
</body>
</html>
